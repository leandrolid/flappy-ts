var m=Object.defineProperty;var u=Object.getOwnPropertySymbols;var x=Object.prototype.hasOwnProperty,w=Object.prototype.propertyIsEnumerable;var y=(n,t,e)=>t in n?m(n,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):n[t]=e;var g=(n,t)=>{var e={};for(var s in n)x.call(n,s)&&t.indexOf(s)<0&&(e[s]=n[s]);if(n!=null&&u)for(var s of u(n))t.indexOf(s)<0&&w.call(n,s)&&(e[s]=n[s]);return e};var h=(n,t,e)=>(y(n,typeof t!="symbol"?t+"":t,e),e);const P=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const o of i)if(o.type==="childList")for(const r of o.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function e(i){const o={};return i.integrity&&(o.integrity=i.integrity),i.referrerpolicy&&(o.referrerPolicy=i.referrerpolicy),i.crossorigin==="use-credentials"?o.credentials="include":i.crossorigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function s(i){if(i.ep)return;i.ep=!0;const o=e(i);fetch(i.href,o)}};P();class l{static getContext(){return this.canvas.getContext("2d")}static getCanvas(){return this.canvas}}h(l,"canvas",document.querySelector("canvas"));class v{onPlayerTap(t){let e;window.addEventListener("keydown",()=>t(e)),window.addEventListener("mousedown",()=>t(e))}onPlayerStart(t){l.getCanvas().addEventListener("click",({offsetX:s,offsetY:i})=>{t("click",{clickX:s,clickY:i})}),window.addEventListener("keypress",()=>t("click",{clickX:0,clickY:0}))}}class c{constructor(t){h(this,"sourceX");h(this,"sourceY");h(this,"sourceWidth");h(this,"sourceHeight");h(this,"destX");h(this,"destY");h(this,"destWidth");h(this,"destHeight");this.elementInfo=t,this.sourceX=0,this.sourceY=0,this.sourceWidth=0,this.sourceHeight=0,this.destX=0,this.destY=0,this.destWidth=0,this.destHeight=0}drawImage(t,...e){this.elementInfo.context.drawImage(this.elementInfo.source,(t==null?void 0:t.sourceX)||this.sourceX,(t==null?void 0:t.sourceY)||this.sourceY,(t==null?void 0:t.sourceWidth)||this.sourceWidth,(t==null?void 0:t.sourceHeight)||this.sourceHeight,(t==null?void 0:t.destX)||this.destX,(t==null?void 0:t.destY)||this.destY,(t==null?void 0:t.destWidth)||this.destWidth,(t==null?void 0:t.destHeight)||this.destHeight)}action(...t){}}class I extends c{constructor(e){super(e);h(this,"speed");h(this,"gravity");h(this,"jump");this.speed=0,this.gravity=.25,this.jump=-4.6,this.sourceX=0,this.sourceY=0,this.sourceWidth=34,this.sourceHeight=25,this.destX=145,this.destY=104,this.destWidth=33,this.destHeight=24}verifyHitFloor(e){const s=this.destY+this.destHeight,i=this.elementInfo.context.canvas.height-112;s>=i&&(this.speed=0,this.destY=this.destY,e("collision"))}verifyHitPipes(e,s){e.length&&e.forEach(([i,o])=>{const r=this.destX+this.destWidth>=i.pipeX||this.destX>=i.pipeX,d=this.destX+this.destWidth<=i.pipeX+52||this.destX<=i.pipeX,a=this.destY<=i.pipeY,p=this.destY+this.destHeight>=o.pipeY;r&&d&&a&&s("collision"),r&&d&&p&&s("collision")})}animateSprites(){this.speed<0?this.sourceY=52:this.speed>-2&&this.speed<2?this.sourceY=26:this.sourceY=0}action({isTapping:e,pipesPositions:s,onFlappyCollision:i}){this.verifyHitFloor(i),e?this.speed=this.jump:(this.speed+=this.gravity,this.destY+=this.speed),this.animateSprites(),this.verifyHitPipes(s,i)}}class X extends c{constructor(t){super(t),this.sourceX=0,this.sourceY=610,this.sourceWidth=224,this.sourceHeight=112,this.destX=0,this.destY=this.elementInfo.context.canvas.height-this.sourceHeight,this.destWidth=this.sourceWidth,this.destHeight=this.sourceHeight}drawImage(){super.drawImage(),super.drawImage({destX:this.destX+this.destWidth})}action(){const e=this.destWidth/2,i=(this.destX-1)%e;this.destX=i}}class W extends c{constructor(t){super(t),this.sourceX=390,this.sourceY=0,this.sourceWidth=275,this.sourceHeight=204,this.destX=0,this.destY=this.elementInfo.context.canvas.height-204,this.destWidth=this.sourceWidth,this.destHeight=this.sourceHeight}drawImage(){this.elementInfo.context.fillStyle="#70c5ce",this.elementInfo.context.fillRect(0,0,this.elementInfo.context.canvas.width,this.elementInfo.context.canvas.height),super.drawImage(),super.drawImage({destX:this.destX+this.destWidth-1})}action(){const e=this.destWidth/2,i=(this.destX-.1)%e;this.destX=i}}class Y extends c{constructor(t){super(t),this.sourceX=0,this.sourceY=169,this.sourceWidth=52,this.sourceHeight=400,this.destX=0,this.destY=0,this.destWidth=this.sourceWidth,this.destHeight=this.sourceHeight}}class H extends c{constructor(t){super(t),this.sourceX=52,this.sourceY=169,this.sourceWidth=52,this.sourceHeight=400,this.destX=0,this.destY=0,this.destWidth=this.sourceWidth,this.destHeight=this.sourceHeight}}class S extends c{constructor(e,s,i){super(e);h(this,"positions");h(this,"spacing");h(this,"pipes");this.pipeTop=s,this.pipeBottom=i,this.positions=[],this.spacing=90,this.pipes=[]}drawImage(){this.positions.forEach(({x:e,y:s})=>{const i={destX:e,destY:s},o={destX:e,destY:this.pipeBottom.destHeight+this.spacing+s};this.pipeTop.drawImage(i),this.pipeBottom.drawImage(o)})}addNewPosition(e){const s=[-150,-175];e%150===0&&this.positions.push({x:this.elementInfo.context.canvas.width,y:s[Math.round(Math.random())]*(Math.random()+1)})}removeOldPosition(){this.positions=this.positions.filter(({x:e})=>e>-52)}setPipesPosition(){if(this.positions.length){const e=this.positions.map(s=>[{name:"top",pipeX:s.x,pipeY:this.pipeTop.destHeight+s.y},{name:"bottom",pipeX:s.x,pipeY:this.pipeBottom.destHeight+this.spacing+s.y}]);this.pipes=e}}action({frames:e}){this.addNewPosition(e),this.setPipesPosition();const s=1;this.positions=this.positions.map(({x:i,y:o})=>({x:i-s,y:o})),this.removeOldPosition(),this.setPipesPosition()}getPositions(){return this.pipes}}class b extends c{constructor(t){super(t),this.sourceX=133,this.sourceY=0,this.sourceWidth=176,this.sourceHeight=151,this.destX=t.context.canvas.width/2-this.sourceWidth/2,this.destY=50,this.destWidth=this.sourceWidth,this.destHeight=this.sourceHeight}}class O extends c{constructor(e){super(e);h(this,"points");h(this,"button");this.sourceX=133,this.sourceY=152,this.sourceWidth=228,this.sourceHeight=202,this.destX=e.context.canvas.width/2-this.sourceWidth/2,this.destY=100,this.destWidth=this.sourceWidth,this.destHeight=this.sourceHeight,this.points={current:0,best:0},this.button={x:this.destX+73,y:this.destY+this.destHeight-29,width:82,height:28}}drawButton(e){this.elementInfo.context.beginPath(),this.elementInfo.context.strokeStyle=e,this.elementInfo.context.lineWidth=3,this.elementInfo.context.strokeRect(this.button.x,this.button.y,this.button.width,this.button.height),this.elementInfo.context.closePath()}animateButtonBorder(e){e%15===0&&this.drawButton("#ffffff"),this.drawButton("#ffffff00")}verifyClickOnButton({clickX:e,clickY:s}){return e>=this.button.x&&e<=this.button.x+this.button.width&&s>=this.button.y&&s<=this.button.y+this.button.height}drawPoints(e,s){this.elementInfo.context.font='15px "Press Start 2P"',this.elementInfo.context.textAlign="right",this.elementInfo.context.fillStyle="#533847",this.elementInfo.context.fillText(`${e}`,this.destX+this.destWidth-22,s)}drawCoins(e,s){this.elementInfo.context.drawImage(this.elementInfo.source,e,s,44,44,this.destX+29,this.destY+90,40,40)}setPoints(){const e=localStorage.getItem("points");e&&(this.points=JSON.parse(e))}setCoinForPointsRange(){this.points.current<=10&&this.drawCoins(0,78),this.points.current>10&&this.points.current<=20&&this.drawCoins(48,78),this.points.current>20&&this.points.current<=30&&this.drawCoins(0,124),this.points.current>30&&this.drawCoins(48,124)}drawImage(e){super.drawImage(e),this.setPoints(),this.setCoinForPointsRange(),this.animateButtonBorder(e.frames),this.drawPoints(this.points.current,this.destY+95),this.drawPoints(this.points.best,this.destY+135)}}class T{static getSprites(t){const e=new Image;return e.src=t,e}}var B="/flappy-ts/assets/sprites.702f2d13.png";class C extends c{constructor(e){super(e);h(this,"points");this.destX=e.context.canvas.width-10,this.destY=40,this.points=0}drawImage(){this.registerPoints()}registerPoints(){const e=localStorage.getItem("points");if(e){const s=JSON.parse(e),i={current:this.points,best:s.best>this.points?s.best:this.points};localStorage.setItem("points",JSON.stringify(i))}else{const s={current:this.points,best:this.points};localStorage.setItem("points",JSON.stringify(s))}}setPoints(e){if(Array.isArray(e)&&e.length>1){const[[o],[r]]=e,d=o.pipeX+52,a=o.pipeX,p=r.pipeX+52,f=r.pipeX;d<=145&&a>=145-52&&(this.points+=1),p<=145&&f>=145-52&&(this.points+=1),this.registerPoints()}}action({pipesPositions:e}){this.setPoints(e),this.elementInfo.context.font='25px "Press Start 2P"',this.elementInfo.context.textAlign="right",this.elementInfo.context.fillStyle="#ffffff",this.elementInfo.context.fillText(`${this.points}`,this.destX,this.destY)}}class k{constructor(t){h(this,"elements");h(this,"frames");h(this,"gameScreen");h(this,"isTapping");this.context=t,this.elements=Object(),this.frames=0,this.gameScreen="ready",this.isTapping=!1}clearScreen(){this.context.clearRect(0,0,this.context.canvas.width,this.context.canvas.height)}setNewGameElements(){const t={source:T.getSprites(B),context:this.context},e=new Y(t),s=new H(t);this.elements={background:new W(t),pipePair:new S(t,s,e),floor:new X(t),flappy:new I(t),score:new C(t),screenReady:new b(t),screenGameOver:new O(t)}}setActionOccurrence(t,e){t==="collision"&&(this.gameScreen="gameOver"),t==="click"&&this.gameScreen==="ready"&&(this.gameScreen="playing"),t==="click"&&this.gameScreen==="gameOver"&&this.elements.screenGameOver.verifyClickOnButton(e)&&(this.gameScreen="playing",this.setNewGameElements())}registerFrames(){this.frames+=1,this.frames===300&&(this.frames=0)}setIsTapping(t){this.isTapping=!0,t&&clearTimeout(t),t=setTimeout(()=>this.isTapping=!1,150)}registerInputs(){const t=new v;t.onPlayerTap(this.setIsTapping.bind(this)),t.onPlayerStart(this.setActionOccurrence.bind(this))}initialize(){this.clearScreen();const i=this.elements,{screenReady:t,screenGameOver:e}=i,s=g(i,["screenReady","screenGameOver"]);for(const o of Object.values(s))o.drawImage(),this.gameScreen==="playing"&&o.action({isTapping:this.isTapping,frames:this.frames,pipesPositions:s.pipePair.getPositions(),onFlappyCollision:this.setActionOccurrence.bind(this)});this.gameScreen==="gameOver"&&e.drawImage({frames:this.frames}),this.gameScreen==="ready"&&t.drawImage(),this.registerFrames(),requestAnimationFrame(()=>this.initialize())}}class E{constructor(){h(this,"context");this.context=l.getContext()}registerGame(){const t=new k(this.context);t.setNewGameElements(),t.registerInputs(),t.initialize()}start(){this.registerGame()}}window.onload=()=>{new E().start()};
